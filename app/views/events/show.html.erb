<script type="text/javascript"
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApTRZxR9qAHBk8vBJDwELX3ExZs5eATIE&sensor=false">
</script>

<% provide(:title, @event.title) %>
<div class="row-fluid">
  <div class="span8 eventprofile offset1">
    <div class="row-fluid">
      <div class="media">
        <% if current_user?(@event.user) %>
        <% else %>
        <div class="pull-left vote">         
          <%= link_to vote_event_path(@event, type: "up"), method: "post" do %>
            <i class="icon-arrow-up"></i>
          <% end %>
          <p><span style="font-size: 18px;color:#d44413;font-family: fantasy"><%=@event.reputation_for(:votes).to_i %></span></p>
          <%= link_to vote_event_path(@event, type: "down"), method: "post" do %>
            <i class="icon-arrow-down"></i>
          <% end %>
        </div>
        <% end %>
        <div class="pull-left image" style="padding-left: 10px;">
        <%= image_tag(@event.event_image_url || "default_avatar.png",:class=>'media-object', :data=>{:src=>'holder.js/64*64'})%> 
        </div>
        <div class="media-body">
          <div class="row-fluid">
          <div class="span9"><h4 id = "titleShown" style="margin: 5px 0px;"><%= @event.title %></h4>
          <p>Organized by <%=link_to @event.user.name, @event.user %>
          <% if current_user?(@event.user) %>
            <%=link_to "edit", edit_event_path(@event) %>
            <%=link_to "delete", event_path(@event),method: :delete,data:{confirm:"Do you want to delete this event?"}%>
          <% end %>
          </p><br>
          <div class = "form-inline">
            <i class="icon-time"></i>
	     <div id="startTimeShown">From: <%= @event.time.strftime('%H:%M, %m/%d/%Y') %></div>
	     <div id="endTimeShown">To: <%= @event.endtime.strftime('%H:%M, %m/%d/%Y') %></div>
	  </div>
          <p id="locationShown"><i class="icon-map-marker"></i><%= @event.place+", "+@event.city %></p><br>
	  <a href="#" id="addCal"  data-placement="bottom" title="add events to google calendar"><p>Add to Google Calendar! (Please allow pop up)</p><i class="icon-calendar"></i></a><button id="linkToCal">Go to Google Calendar</button><br>
          <p><span class="color"><%= @event.participants.count %></span> people attend</p>
          </div>
          <div class="span3" style="padding-top: 25px; text-align: center;"><% if current_user?(@event.user) %>
          <% else %>
            <!--button attend event-->
            <% unless current_user?(@event.user) %>
            <div id="follow_form">
            <% if current_user.attending?(@event) %>
            <%= form_for(current_user.attendrelations.find_by_event_id(@event),html: { method: :delete }) do |f| %>
              <%= f.submit "Unattend", class: "btn btn-large" %>
              <% end %>
            <% else %>
            <%= form_for(current_user.attendrelations.build(event_id: @event.id)) do |f| %>
              <div><%= f.hidden_field :event_id %></div>
              <%= f.submit "Attend", class: "btn btn-large btn-primary" %>
              <% end %>
            <% end %>
            </div>
            <% end %><!--button ends-->
          <% end %></div>
          </div><br>
          
        </div><!--media body ends-->
      </div>
      <div class="row-fluid">
        <a href="#" class="iconbutton"><i class="icon-edit"></i>Send an email to host</a>
        <a href="#" class="iconbutton"><i class="icon-comment"></i>Write a comment</a>
      </div>
    </div>
    <div class="row-fluid">
      <h4>Event Description</h4>
      <hr class="line">
      <div id = "summary" class="eventcontent">
      <p id = "descriptionShown"><%= @event.content %></p>
      </div>
    </div>
    <div class="row-fluid">
      <h4>Users Attend This Event<a href="#" class="more">More</a></h4>
      <hr class="line">
      <div>
        <ul class="thumbnails attendlist">
          <% @event.participants.each do |user| %>
          <li class="span2">
            <div class="thumbnail">
              <%=image_tag(user.image_url || "default_profile.jpg") %>
              <br>
              <p><%= link_to user.name, user %></p>
            </div>
          </li>
          <% end %>
        </ul>
      </div>
    </div>
    <div class="row-fluid">
      <h4>Comments</h4>
      <hr class="line">
        <% @event.comment_threads.order('created_at DESC').each do |comment| %>
        <% if !comment.parent_id.blank? %>
          <p>reply <%= comment.parent.user.name %></p>
        <% end %>
          <p><%= comment.body %>, <%= link_to comment.user.name, comment.user %>, <%= time_ago_in_words(comment.created_at) %> ago.</p>
       
        <%end%>
      <div class="comments">
        <%= form_for(@new_comment) do |f|%>
          <%=f.text_area :body, :placeholder => "Your comment goes here."%><br/><br/>
          <%=f.hidden_field :event_id, :value => @event.id %>
          <%=f.hidden_field :commentable_id, :value => @event.id %>  <!--change value into comment.id -->
          <%=f.hidden_field :commentable_type, :value => 'Event' %>  <!--change value into 'Comment'-->
          <%=f.submit "Add comment"%>
        <%end%>
      </div>
    </div>
  </div>
  <div class="span3">
    <div style="background-color:#f5f5f5">
    <h4>Where</h4>
    <div>
    <div id="map_canvas"><br/><br/></div>
    <a id="returnAddress" class="madeUpButton">Reset center</a>
    </div>
    
    </div>
  </div>
</div>
